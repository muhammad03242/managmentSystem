<div class="container">
  <div class="page-header">
    <div>
      <h1 class="page-title">Apply for Leave</h1>
      <p class="page-subtitle">Submit a new leave application</p>
    </div>
    <button mat-button routerLink="/leave">
      <mat-icon>arrow_back</mat-icon>
      Back to List
    </button>
  </div>

  <mat-card class="form-card">
    <mat-card-content>
      <form [formGroup]="leaveForm" (ngSubmit)="onSubmit()">
        <div class="form-section">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-full">
              <mat-label>Select Employee</mat-label>
              <mat-select formControlName="employeeId">
                @for (employee of employees; track employee.id) {
                  <mat-option [value]="employee.id">
                    {{ employee.employeeCode }} - {{ employee.firstName }} {{ employee.lastName }} ({{ employee.designation }})
                  </mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>person</mat-icon>
              @if (leaveForm.get('employeeId')?.hasError('required') && leaveForm.get('employeeId')?.touched) {
                <mat-error>Please select an employee</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-full">
              <mat-label>Leave Type</mat-label>
              <mat-select formControlName="leaveType">
                @for (type of leaveTypes; track type.value) {
                  <mat-option [value]="type.value">{{ type.label }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>event_busy</mat-icon>
              @if (leaveForm.get('leaveType')?.hasError('required') && leaveForm.get('leaveType')?.touched) {
                <mat-error>Please select leave type</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Start Date</mat-label>
              <input matInput [matDatepicker]="startPicker" formControlName="startDate">
              <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
              <mat-datepicker #startPicker></mat-datepicker>
              <mat-icon matPrefix>calendar_today</mat-icon>
              @if (leaveForm.get('startDate')?.hasError('required') && leaveForm.get('startDate')?.touched) {
                <mat-error>Start date is required</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>End Date</mat-label>
              <input matInput [matDatepicker]="endPicker" formControlName="endDate">
              <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
              <mat-datepicker #endPicker></mat-datepicker>
              <mat-icon matPrefix>event</mat-icon>
              @if (leaveForm.get('endDate')?.hasError('required') && leaveForm.get('endDate')?.touched) {
                <mat-error>End date is required</mat-error>
              }
            </mat-form-field>
          </div>

          @if (calculatedDays > 0) {
            <div class="days-info">
              <mat-icon>info</mat-icon>
              <span>Total Leave Days: <strong>{{ calculatedDays }} days</strong></span>
            </div>
          }

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field-full">
              <mat-label>Reason for Leave</mat-label>
              <textarea matInput formControlName="reason" rows="4" placeholder="Please provide detailed reason for leave application..."></textarea>
              <mat-icon matPrefix>description</mat-icon>
              @if (leaveForm.get('reason')?.hasError('required') && leaveForm.get('reason')?.touched) {
                <mat-error>Reason is required</mat-error>
              }
              @if (leaveForm.get('reason')?.hasError('minlength') && leaveForm.get('reason')?.touched) {
                <mat-error>Reason must be at least 10 characters</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button type="button" (click)="onCancel()">
            <mat-icon>close</mat-icon>
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit">
            <mat-icon>send</mat-icon>
            Submit Application
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Leave Policy Info -->
  <mat-card class="info-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>info</mat-icon>
        Leave Policy Information
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="policy-grid">
        <div class="policy-item">
          <strong>Casual Leave:</strong>
          <span>15 days per year</span>
        </div>
        <div class="policy-item">
          <strong>Sick Leave:</strong>
          <span>10 days per year</span>
        </div>
        <div class="policy-item">
          <strong>Annual Leave:</strong>
          <span>20 days per year</span>
        </div>
        <div class="policy-item">
          <strong>Maternity Leave:</strong>
          <span>90 days (Female employees)</span>
        </div>
      </div>
      <p class="policy-note">
        <mat-icon>lightbulb</mat-icon>
        All leave applications must be submitted at least 3 days in advance except for emergency or sick leave.
      </p>
    </mat-card-content>
  </mat-card>
</div>

